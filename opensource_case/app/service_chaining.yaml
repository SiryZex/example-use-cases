tosca_definitions_version: cloudify_dsl_1_3

imports:
  - haproxy--blueprint:connected_host
  - pfsense--blueprint:connected_host
  - httpd--blueprint:connected_host
  - plugin:cloudify-utilities-plugin

inputs:
  network_deployment_name:
    description: Deployment name of the VNF network

node_templates:
  network:
    type: cloudify.nodes.DeploymentProxy
    properties:
      resource_config:
        blueprint:
          id: { get_input: network_deployment_name }
          blueprint_archive: https://drive.google.com/open?id=19ri_XS-cp2k0aqgpx8A5fJUwPJyGYnB3
          main_file_name: network_topolgy.yaml
          external_resource: true
        deployment:
          id: { get_input: network_deployment_name }
          outputs:
            external_network: external_network
            mgmt_network: mgmt_network
            public_network: public_network
            private_network: private_key_path
            external_ip: external_ip
          external_resource: true
        reexecute: false

  # network:
  #   type: cloudify.nodes.CapabilityProxy
  #   properties:
  #     resource_config:
  #       blueprint:
  #         id: { get_input: network_deployment_name }
  #         blueprint_archive: https://drive.google.com/open?id=19ri_XS-cp2k0aqgpx8A5fJUwPJyGYnB3
  #         main_file_name: network_topolgy.yaml
  #         external_resource: true
  #       deployment:
  #         id: { get_input: network_deployment_name }
  #         external_resource: true
  #       reexecute: false

    # haproxy--host:
    #   relationships:
    #     - type: cloudify.relationships.depends_on:
    #       target: network
    #     - type: cloudify.openstack.server_connected_to_floating_ip
    #       target: { get_capatbility: [network, external_ip] }
    #     - type: cloudify.relationships.connected_to
    #       target: { get_capatbility: [network, public_network] }
    #     - type: cloudify.relationships.connected_to
    #       target: { get_capatbility: [network, mgmt_network] }

  haproxy--host:
    relationships:
      - type: cloudify.openstack.server_connected_to_floating_ip
        target: external_ip
      - type: cloudify.relationships.connected_to
        target: public_network
      - type: cloudify.relationships.connected_to
        target: mgmt_network

  httpd--host:
    relationships:
      - type: cloudify.relationships.connected_to
        target: private_network
      - type: cloudify.relationships.connected_to
        target: mgmt_network

  pfsense--host:
    relationships:
      - type: cloudify.relationships.connected_to
        target: private_network
      - type: cloudify.relationships.connected_to
        target: mgmt_network
      - type: cloudify.relationships.connected_to
        target: public_network
